
/*1)List customers who have overdue books*/
/*SELECT c.first_name, c.last_name, c.email, c.phone_number, b.title, i.due_date FROM customers AS c
JOIN issued_books AS i ON c.id = i.customer_id
JOIN books AS b ON i.book_id=b.id
WHERE i.return_date IS NULL AND i.due_date < CURRENT_DATE;*/
/*
SELECT b.title, COUNT(i.book_id) AS total_issued
FROM issued_books AS i
JOIN books AS b ON i.book_id=b.id
GROUP BY b.title 
ORDER BY total_issued DESC;*/
select id from books
where category='Thriller'

/*3)List customers who have never issued a book*/
/*SELECT * 
FROM customers
WHERE id NOT IN(SELECT customer_id FROM issued_books);*/


/*4)Update book price by 10% for books issued before Current date*/

/*update books 
set price=price*1.1
where id in (select book_id from issued_books
where issue_date<current_date)*/

/*5)Delete all overdue issued book records*/
/*5)Delete all overdue issued book records*/
/*6)List total revenue generated from issued books*/


/*select sum(price) from books as b
inner join issued_books as i on i.book_id=b.id*/
select category from books
group by category
/*8.список книг и кто за них отвечает */
/*select b.title,s.name from books as b
inner join staff as s on s.c= b.category
order by b.id asc*/
/*9. сколько книг курирует 1 человек*/

/*select s.name,count(b.title) from books as b
inner join staff as s on s.c= b.category
group by s.name*/
create table staff
(
id SERIAL PRIMARY KEY,
name VARCHAR(255) NOT NULL,
c VARCHAR(255) NOT NULL 
);



/*10. рейгни и колво испол каждой книги*/
/*select* from books as b
inner join rating as  r on r.book_id=b.id*/
/*11.самый популярный атвор и книга в категории*/

/*select b.title,b.author,b.category,b.count from (select * from books as b inner join rating as r on r.book_id=b.id) b
inner join 
(select category, max(r.count) as max from rating as r
inner join books b on r.book_id=b.id
group by category) a on a.category=b.category and a.max=b.count 
order by b.count desc
*/
/*по каждой категории сколько скача * проанализировать кто больше всего имеет рейтинг и как связть рейтинг и кол
и колво скачиваний*/

/*select b.category,rating ,cast(avg(rating) over(partition by b.category)as numeric(5,2)),sum(count) over(partition by b.category)as taken,
min(rating) over (partition by b.category) as min_rat,max(rating) over (partition by b.category) as max_rat,
cast(percent_rank() over(partition by b.category order by rating)as numeric(5,3))
from books as b
inner join rating as  r on r.book_id=b.id*/


/*по данным можно сделать вывод макс ср.рейтинг у биографии миним ср рейтинг у ронатики, больше всего берут итсорию
меньше всего self help 
романтика также получала наих из всех оценки, все кроме истории получали макс 5
по процентам 
категории у которых оценка больше чем 4.2 это биография (67%).история(56) мистери(55)
хуже всего показатель у фикшион (23%)
но насчет self-heplp сложно что то скзать так как их всего 2

